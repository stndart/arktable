<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Character Grid Manager</title>
    <style>
        /* Basic page styling */
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
            background-color: #f0f0f0;
        }

        /* Grid container styling */
        .grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            gap: 10px;
            margin: 20px 0;
        }

        /* Individual character cell */
        .character-cell {
            position: relative;
            border: 2px solid #333;
            border-radius: 8px;
            padding: 10px;
            background-color: white;
            cursor: grab;
            transition: transform 0.2s;
        }

        /* Alternate background colors for checkered pattern */
        .character-cell:nth-child(even) {
            background-color: #f8f8f8;
        }

        /* Character image styling */
        .character-image {
            width: 100%;
            height: 150px;
            object-fit: contain;
        }

        /* Check mark styling */
        .check-mark {
            position: absolute;
            top: 5px;
            left: 5px;
            font-size: 24px;
            color: #00ff00;
            display: none;
        }

        /* Red circles container */
        .circles {
            position: absolute;
            bottom: 5px;
            right: 5px;
            display: flex;
            gap: 2px;
        }

        /* Individual circle styling */
        .circle {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background-color: #ff0000;
            display: none;
        }

        /* Control buttons styling */
        .controls {
            margin: 20px 0;
            display: flex;
            gap: 10px;
        }

        button {
            padding: 8px 16px;
            background-color: #4CAF50;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }

        /* Context menu for right-click */
        .context-menu {
            position: fixed;
            background: white;
            border: 1px solid #ccc;
            box-shadow: 2px 2px 5px rgba(0,0,0,0.2);
            display: none;
        }
    </style>
</head>
<body>
    <div class="controls">
        <button id="save">Save Layout</button>
        <button id="addCharacter">Add Character</button>
        <button id="deleteMode">Delete Mode</button>
    </div>
    
    <div id="characterGrid" class="grid"></div>

    <!-- Context menu for circle controls -->
    <div class="context-menu" id="contextMenu">
        <div class="menu-item" onclick="addCircle()">Add Circle</div>
        <div class="menu-item" onclick="removeCircle()">Remove Circle</div>
    </div>

    <script>
        // Sample character data - would normally come from server
        const sampleCharacters = [
            { id: 'wizadel', name: 'Warrior', image: 'wizadel.png' },
            { id: 'adel', name: 'Mage', image: 'adel.png' }
        ];

        class GridManager {
            constructor() {
                this.grid = document.getElementById('characterGrid');
                this.currentState = [];
                this.selectedCharacter = null;
                
                // Load initial data
                this.loadCharacters();
                this.setupEventListeners();
            }

            // Load characters into grid
            loadCharacters() {
                sampleCharacters.forEach(character => {
                    const cell = this.createCharacterCell(character);
                    this.grid.appendChild(cell);
                });
            }

            // Create individual character cell
            createCharacterCell(character) {
                const cell = document.createElement('div');
                cell.className = 'character-cell';
                cell.dataset.characterId = character.id;
                cell.draggable = true;

                cell.innerHTML = `
                    <div class="check-mark">âœ“</div>
                    <img src="characters/${character.image}" class="character-image">
                    <div class="circles">
                        <div class="circle"></div>
                        <div class="circle"></div>
                        <div class="circle"></div>
                    </div>
                `;

                return cell;
            }

            // Set up event listeners
            setupEventListeners() {
                // Left click for check mark
                this.grid.addEventListener('click', (e) => {
                    const cell = e.target.closest('.character-cell');
                    if (cell) {
                        const checkMark = cell.querySelector('.check-mark');
                        checkMark.style.display = checkMark.style.display === 'none' ? 'block' : 'none';
                    }
                });

                // Right click for circles
                this.grid.addEventListener('contextmenu', (e) => {
                    e.preventDefault();
                    const cell = e.target.closest('.character-cell');
                    if (cell) {
                        this.selectedCharacter = cell;
                        this.showContextMenu(e.clientX, e.clientY);
                    }
                });

                // Drag and drop setup
                this.grid.addEventListener('dragstart', (e) => {
                    e.dataTransfer.setData('text/plain', e.target.dataset.characterId);
                });

                this.grid.addEventListener('dragover', (e) => {
                    e.preventDefault();
                });

                this.grid.addEventListener('drop', (e) => {
                    e.preventDefault();
                    const draggedId = e.dataTransfer.getData('text/plain');
                    const targetCell = e.target.closest('.character-cell');
                    
                    if (targetCell) {
                        const draggedElement = document.querySelector(`[data-character-id="${draggedId}"]`);
                        const targetIndex = Array.from(this.grid.children).indexOf(targetCell);
                        this.grid.insertBefore(draggedElement, targetCell);
                    }
                });

                // Control buttons
                document.getElementById('addCharacter').addEventListener('click', () => this.addNewCharacter());
                document.getElementById('deleteMode').addEventListener('click', () => this.toggleDeleteMode());
            }

            // Context menu functions
            showContextMenu(x, y) {
                const menu = document.getElementById('contextMenu');
                menu.style.display = 'block';
                menu.style.left = `${x}px`;
                menu.style.top = `${y}px`;
            }

            addCircle() {
                const circles = this.selectedCharacter.querySelectorAll('.circle');
                for (let i = 0; i < circles.length; i++) {
                    if (circles[i].style.display === 'none') {
                        circles[i].style.display = 'block';
                        break;
                    }
                }
                this.hideContextMenu();
            }

            removeCircle() {
                const circles = this.selectedCharacter.querySelectorAll('.circle');
                for (let i = circles.length - 1; i >= 0; i--) {
                    if (circles[i].style.display === 'block') {
                        circles[i].style.display = 'none';
                        break;
                    }
                }
                this.hideContextMenu();
            }

            hideContextMenu() {
                document.getElementById('contextMenu').style.display = 'none';
            }

            // Add new character functionality
            addNewCharacter() {
                // In real implementation, this would open a form
                const newChar = {
                    id: `char${Date.now()}`,
                    name: 'New Character',
                    image: 'default.png'
                };
                const cell = this.createCharacterCell(newChar);
                this.grid.appendChild(cell);
            }

            // Delete mode toggle
            toggleDeleteMode() {
                this.grid.classList.toggle('delete-mode');
                this.grid.querySelectorAll('.character-cell').forEach(cell => {
                    cell.style.cursor = this.grid.classList.contains('delete-mode') ? 'pointer' : 'grab';
                    cell.addEventListener('click', this.handleDelete);
                });
            }

            handleDelete(e) {
                if (this.grid.classList.contains('delete-mode')) {
                    e.target.closest('.character-cell').remove();
                    this.grid.classList.remove('delete-mode');
                }
            }
        }

        // Initialize the grid when page loads
        window.onload = () => new GridManager();
    </script>
</body>
</html>